<!DOCTYPE html><html> <head><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0"><title>reacnetgenerator.utils &#8212; ReacNetGenerator documentation</title><!-- Loaded before other Sphinx assets --><link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel=stylesheet><link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel=stylesheet><link rel=stylesheet href=../../_static/vendor/fontawesome/5.13.0/css/all.min.css><link rel=preload as=font type=font/woff2 crossorigin href=../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2><link rel=preload as=font type=font/woff2 crossorigin href=../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2><link rel=stylesheet type=text/css href=../../_static/pygments.css><link rel=stylesheet href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type=text/css><link rel=stylesheet type=text/css href=../../_static/css/custom.css><!-- Pre-loaded scripts that we'll load fully later --><link rel=preload as=script href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"><script data-url_root=../../ id=documentation_options src=../../_static/documentation_options.js></script><script src=../../_static/jquery.js></script><script src=../../_static/underscore.js></script><script src=../../_static/doctools.js></script><script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script><script src=https://unpkg.com/bilitube@0/dist/bilitube.min.js></script><link rel=index title=Index href=../../genindex.html><link rel=search title=Search href=../../search.html><meta name=viewport content="width=device-width, initial-scale=1"><meta name=docsearch:language content=None><!-- Google Analytics --></head> <body data-spy=scroll data-target=#bd-toc-nav data-offset=60> <!-- Checkboxes to toggle the left sidebar --> <input type=checkbox class=sidebar-toggle name=__navigation id=__navigation aria-label="Toggle navigation sidebar"> <label class="overlay overlay-navbar" for=__navigation> <div class=visually-hidden>Toggle navigation sidebar</div> </label> <!-- Checkboxes to toggle the in-page toc --> <input type=checkbox class=sidebar-toggle name=__page-toc id=__page-toc aria-label="Toggle in-page Table of Contents"> <label class="overlay overlay-pagetoc" for=__page-toc> <div class=visually-hidden>Toggle in-page Table of Contents</div> </label> <!-- Headers at the top --> <div class="announcement header-item noprint"></div> <div class="header header-item noprint"></div> <div class=container-fluid id=banner></div> <div class=container-xl> <div class=row> <!-- Sidebar --> <div class="bd-sidebar noprint" id=site-navigation> <div class=bd-sidebar__content> <div class=bd-sidebar__top><div class=navbar-brand-box> <a class="navbar-brand text-wrap" href=../../index.html> <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 --> <img src=../../_static/reacnetgen.svg class=logo alt=logo> <h1 class=site-logo id=site-title>ReacNetGenerator documentation</h1> </a> </div><form class="bd-search d-flex align-items-center" action=../../search.html method=get> <i class="icon fas fa-search"></i> <input type=search class=form-control name=q id=search-input placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete=off> </form><nav class=bd-links id=bd-docs-nav aria-label=Main> <div class="bd-toc-item active"> <ul class="nav bd-sidenav bd-sidenav__home-link"> <li class=toctree-l1> <a class="reference internal" href=../../index.html> ReacNetGenerator </a> </li> </ul> <ul class="nav bd-sidenav"> <li class="toctree-l1 has-children"> <a class="reference internal" href=../../guide/index.html> Guides </a> <input class=toctree-checkbox id=toctree-checkbox-1 name=toctree-checkbox-1 type=checkbox> <label for=toctree-checkbox-1> <i class="fas fa-chevron-down"> </i> </label> <ul> <li class=toctree-l2> <a class="reference internal" href=../../guide/install.html> Installation </a> </li> <li class=toctree-l2> <a class="reference internal" href=../../guide/build.html> Build ReacNetGenerator </a> </li> <li class=toctree-l2> <a class="reference internal" href=../../guide/cli.html> Command line interface </a> </li> <li class=toctree-l2> <a class="reference internal" href=../../guide/hmm.html> Enable HMM filter </a> </li> <li class=toctree-l2> <a class="reference internal" href=../../guide/gui.html> GUI version </a> </li> <li class=toctree-l2> <a class="reference internal" href=../../guide/python.html> Python interface </a> </li> </ul> </li> <li class="toctree-l1 has-children"> <a class="reference internal" href=../../tutorial/index.html> Tutorials and Applications </a> <input class=toctree-checkbox id=toctree-checkbox-2 name=toctree-checkbox-2 type=checkbox> <label for=toctree-checkbox-2> <i class="fas fa-chevron-down"> </i> </label> <ul> <li class=toctree-l2> <a class="reference internal" href=../../tutorial/methane.html> Simulation of the oxidation of methane </a> </li> <li class=toctree-l2> <a class="reference internal" href=../../tutorial/cl20.html> The thermal decomposition of CL-20 (C <sub> 6 </sub> H <sub> 6 </sub> N <sub> 12 </sub> O <sub> 12 </sub> ) </a> </li> </ul> </li> <li class="toctree-l1 has-children"> <a class="reference internal" href=../../develop.html> Developing </a> <input class=toctree-checkbox id=toctree-checkbox-3 name=toctree-checkbox-3 type=checkbox> <label for=toctree-checkbox-3> <i class="fas fa-chevron-down"> </i> </label> <ul> <li class="toctree-l2 has-children"> <a class="reference internal" href=../../api/api.html> Python API </a> <input class=toctree-checkbox id=toctree-checkbox-4 name=toctree-checkbox-4 type=checkbox> <label for=toctree-checkbox-4> <i class="fas fa-chevron-down"> </i> </label> <ul> <li class=toctree-l3> <a class="reference internal" href=../../api/reacnetgenerator.html> reacnetgenerator package </a> </li> </ul> </li> </ul> </li> <li class="toctree-l1 has-children"> <a class="reference internal" href=../../external.html> External resources </a> <input class=toctree-checkbox id=toctree-checkbox-5 name=toctree-checkbox-5 type=checkbox> <label for=toctree-checkbox-5> <i class="fas fa-chevron-down"> </i> </label> <ul> <li class=toctree-l2> <a class="reference external" href=https://doi.org/10.1039/C9CP05091D> ReacNetGenerator paper </a> </li> <li class=toctree-l2> <a class="reference external" href="https://scholarship.libraries.rutgers.edu/view/pdfCoverPage?instCode=01RUT_INST&filePid=13678734780004646&download=true"> Accepted manuscript </a> </li> <li class=toctree-l2> <a class="reference external" href=https://github.com/tongzhugroup/reacnetgenerator> GitHub </a> </li> <li class=toctree-l2> <a class="reference external" href=https://computchem.cn> Research group </a> </li> </ul> </li> </ul> </div> </nav></div> <div class=bd-sidebar__bottom> <!-- To handle the deprecated key --> <div class=navbar_extra_footer> Theme by the <a href=https://ebp.jupyterbook.org>Executable Book Project</a> </div> </div> </div> <div id=rtd-footer-container></div> </div> <!-- A tiny helper pixel to detect if we've scrolled --> <div class=sbt-scroll-pixel-helper></div> <!-- Main content --> <div class="col py-0 content-container"> <div class="header-article row sticky-top noprint"> <div class="col py-1 d-flex header-article-main"> <div class=header-article__left> <label for=__navigation class=headerbtn data-toggle=tooltip data-placement=right title="Toggle navigation"> <span class=headerbtn__icon-container> <i class="fas fa-bars"></i> </span> </label> </div> <div class=header-article__right> <button onclick=toggleFullScreen() class=headerbtn data-toggle=tooltip data-placement=bottom title="Fullscreen mode"> <span class=headerbtn__icon-container> <i class="fas fa-expand"></i> </span> </button> <div class="menu-dropdown menu-dropdown-repository-buttons"> <button class="headerbtn menu-dropdown__trigger" aria-label="Source repositories"> <i class="fab fa-github"></i> </button> <div class=menu-dropdown__content> <ul> <li> <a href=https://github.com/tongzhugroup/reacnetgenerator class=headerbtn data-toggle=tooltip data-placement=left title="Source repository"> <span class=headerbtn__icon-container> <i class="fab fa-github"></i> </span> <span class=headerbtn__text-container>repository</span> </a> </li> <li> <a href="https://github.com/tongzhugroup/reacnetgenerator/issues/new?title=Issue%20on%20page%20%2F_modules/reacnetgenerator/utils.html&body=Your%20issue%20content%20here." class=headerbtn data-toggle=tooltip data-placement=left title="Open an issue"> <span class=headerbtn__icon-container> <i class="fas fa-lightbulb"></i> </span> <span class=headerbtn__text-container>open issue</span> </a> </li> </ul> </div> </div> </div> </div> <!-- Table of contents --> <div class="col-md-3 bd-toc show noprint"> </div> </div> <div class="article row"> <div class="col pl-md-3 pl-lg-5 content-container"> <!-- Table of contents that is only displayed when printing the page --> <div id=jb-print-docs-body class=onlyprint> <h1></h1> <!-- Table of contents --> <div id=print-main-content> <div id=jb-print-toc> </div> </div> </div> <main id=main-content role=main> <div> <h1>Source code for reacnetgenerator.utils</h1><div class=highlight><pre>
<span></span><span class=c1># cython: language_level=3</span>
<span class=c1># cython: linetrace=True</span>
<span class=sd>&quot;&quot;&quot;Provide utils for ReacNetGenerator.&quot;&quot;&quot;</span>


<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>import</span> <span class=nn>shutil</span>
<span class=kn>import</span> <span class=nn>itertools</span>
<span class=kn>import</span> <span class=nn>pickle</span>
<span class=kn>import</span> <span class=nn>hashlib</span>
<span class=kn>import</span> <span class=nn>asyncio</span>
<span class=kn>from</span> <span class=nn>multiprocessing</span> <span class=kn>import</span> <span class=n>Pool</span><span class=p>,</span> <span class=n>Semaphore</span>

<span class=kn>import</span> <span class=nn>lz4.frame</span>
<span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
<span class=kn>import</span> <span class=nn>pybase64</span>
<span class=kn>import</span> <span class=nn>requests</span>
<span class=kn>from</span> <span class=nn>requests.adapters</span> <span class=kn>import</span> <span class=n>HTTPAdapter</span>
<span class=kn>from</span> <span class=nn>tqdm</span> <span class=kn>import</span> <span class=n>tqdm</span>

<span class=kn>from</span> <span class=nn>._logging</span> <span class=kn>import</span> <span class=n>logger</span>


<div class=viewcode-block id=WriteBuffer><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.WriteBuffer>[docs]</a><span class=k>class</span> <span class=nc>WriteBuffer</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;Store a buffer for writing files.</span>

<span class=sd>    It is expensive to write to a file, so we need to make a buffer.</span>
<span class=sd>    </span>
<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    f: fileObject</span>
<span class=sd>        The file object to write.</span>
<span class=sd>    linenumber: int, default: 1200</span>
<span class=sd>        The number of contents to store in the buffer. The buffer will be flushed</span>
<span class=sd>        if it exceeds the set number.</span>
<span class=sd>    sep: str or bytes, default: None</span>
<span class=sd>        The separator for contents. If None (default), there will be no separator.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>linenumber</span><span class=o>=</span><span class=mi>1200</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>f</span> <span class=o>=</span> <span class=n>f</span>
        <span class=k>if</span> <span class=n>sep</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sep</span> <span class=o>=</span> <span class=n>sep</span>
        <span class=k>elif</span> <span class=n>f</span><span class=o>.</span><span class=n>mode</span> <span class=o>==</span> <span class=s1>&#39;w&#39;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sep</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
        <span class=k>elif</span> <span class=n>f</span><span class=o>.</span><span class=n>mode</span> <span class=o>==</span> <span class=s1>&#39;wb&#39;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>sep</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=s2>&quot;File mode should be w or wb!&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>linenumber</span> <span class=o>=</span> <span class=n>linenumber</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>buff</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>f</span><span class=o>.</span><span class=n>name</span>

<div class=viewcode-block id=WriteBuffer.append><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.WriteBuffer.append>[docs]</a>    <span class=k>def</span> <span class=nf>append</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>):</span>
        <span class=sd>&quot;&quot;&quot;Append a text.</span>
<span class=sd>        </span>
<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        text: str</span>
<span class=sd>            The text to be appended.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>buff</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>check</span><span class=p>()</span></div>

<div class=viewcode-block id=WriteBuffer.extend><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.WriteBuffer.extend>[docs]</a>    <span class=k>def</span> <span class=nf>extend</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>text</span><span class=p>):</span>
        <span class=sd>&quot;&quot;&quot;Extend texts.</span>

<span class=sd>        Paramenters</span>
<span class=sd>        -----------</span>
<span class=sd>        text: list of strs</span>
<span class=sd>            Texts to be extended.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>buff</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>check</span><span class=p>()</span></div>

<div class=viewcode-block id=WriteBuffer.check><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.WriteBuffer.check>[docs]</a>    <span class=k>def</span> <span class=nf>check</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=sd>&quot;&quot;&quot;Check if the number of stored contents exceeds.</span>
<span class=sd>        </span>
<span class=sd>        If so, the buffer will be flushed.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>buff</span><span class=p>)</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>linenumber</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span></div>

<div class=viewcode-block id=WriteBuffer.flush><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.WriteBuffer.flush>[docs]</a>    <span class=k>def</span> <span class=nf>flush</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=sd>&quot;&quot;&quot;Flush the buffer.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>buff</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>f</span><span class=o>.</span><span class=n>writelines</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>sep</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>buff</span><span class=p>),</span> <span class=bp>self</span><span class=o>.</span><span class=n>sep</span><span class=p>])</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>buff</span><span class=p>[:]</span> <span class=o>=</span> <span class=p>[]</span></div>

    <span class=k>def</span> <span class=fm>__enter__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=k>return</span> <span class=bp>self</span>

    <span class=k>def</span> <span class=fm>__exit__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>exc_type</span><span class=p>,</span> <span class=n>exc_value</span><span class=p>,</span> <span class=n>traceback</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>f</span><span class=o>.</span><span class=fm>__exit__</span><span class=p>(</span><span class=n>exc_type</span><span class=p>,</span> <span class=n>exc_value</span><span class=p>,</span> <span class=n>traceback</span><span class=p>)</span></div>


<div class=viewcode-block id=appendIfNotNone><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.appendIfNotNone>[docs]</a><span class=k>def</span> <span class=nf>appendIfNotNone</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>wbytes</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>wbytes</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>f</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>wbytes</span><span class=p>)</span></div>


<div class=viewcode-block id=produce><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.produce>[docs]</a><span class=k>def</span> <span class=nf>produce</span><span class=p>(</span><span class=n>semaphore</span><span class=p>,</span> <span class=n>plist</span><span class=p>,</span> <span class=n>parameter</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Item producer with a semaphore.</span>
<span class=sd>    </span>
<span class=sd>    Prevent large memory usage due to slow IO.</span>
<span class=sd>    </span>
<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    semaphore: multiprocessing.Semaphore</span>
<span class=sd>        The semaphore to acquire.</span>
<span class=sd>    plist: list of objects</span>
<span class=sd>        The list of items to be passed.</span>
<span class=sd>    parameter: object</span>
<span class=sd>        The parameter yielded with each item.</span>

<span class=sd>    Yield</span>
<span class=sd>    -----</span>
<span class=sd>    item: object</span>
<span class=sd>        The item to be yielded.</span>
<span class=sd>    parameter: object</span>
<span class=sd>        The parameter yielded with each item.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>plist</span><span class=p>:</span>
        <span class=n>semaphore</span><span class=o>.</span><span class=n>acquire</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>parameter</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>item</span> <span class=o>=</span> <span class=p>(</span><span class=n>item</span><span class=p>,</span> <span class=n>parameter</span><span class=p>)</span>
        <span class=k>yield</span> <span class=n>item</span></div>


<div class=viewcode-block id=compress><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.compress>[docs]</a><span class=k>def</span> <span class=nf>compress</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>isbytes</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Compress the line.</span>

<span class=sd>    This function reduces IO overhead to speed up the program. The functions will</span>
<span class=sd>    use lz4 to compress and base64 to encode, since lz4 has better performance</span>
<span class=sd>    that any others.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    x: str or bytes</span>
<span class=sd>        The line to compress.</span>
<span class=sd>    isbytes: bool, optional, default: False</span>
<span class=sd>        If `x` is bytes. If not, `x` will be converted to bytes first.</span>
<span class=sd>    </span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    bytes</span>
<span class=sd>        The compressed line, with a linebreak in the end.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>isbytes</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>pybase64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>lz4</span><span class=o>.</span><span class=n>frame</span><span class=o>.</span><span class=n>compress</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>compression_level</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span>
    <span class=k>return</span> <span class=n>pybase64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>lz4</span><span class=o>.</span><span class=n>frame</span><span class=o>.</span><span class=n>compress</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>compression_level</span><span class=o>=-</span><span class=mi>1</span><span class=p>))</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span></div>


<div class=viewcode-block id=decompress><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.decompress>[docs]</a><span class=k>def</span> <span class=nf>decompress</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>isbytes</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Decompress the line.</span>
<span class=sd>    </span>
<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    x: bytes</span>
<span class=sd>        The line to decompress.</span>
<span class=sd>    isbytes: bool, optional, default: False</span>
<span class=sd>        If the decompressed content is bytes. If not, the line will be decoded.</span>
<span class=sd>    </span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    str or bytes</span>
<span class=sd>        The decompressed line.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>isbytes</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>lz4</span><span class=o>.</span><span class=n>frame</span><span class=o>.</span><span class=n>decompress</span><span class=p>(</span><span class=n>pybase64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>strip</span><span class=p>(),</span> <span class=n>validate</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>lz4</span><span class=o>.</span><span class=n>frame</span><span class=o>.</span><span class=n>decompress</span><span class=p>(</span><span class=n>pybase64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>strip</span><span class=p>(),</span> <span class=n>validate</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span></div>


<div class=viewcode-block id=listtobytes><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.listtobytes>[docs]</a><span class=k>def</span> <span class=nf>listtobytes</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Convert an object to a compressed line.</span>
<span class=sd>    </span>
<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    x: object</span>
<span class=sd>        The object to convert, such as numpy.ndarray.</span>
<span class=sd>    </span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    bytes</span>
<span class=sd>        The compressed line.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>compress</span><span class=p>(</span><span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>isbytes</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></div>


<div class=viewcode-block id=bytestolist><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.bytestolist>[docs]</a><span class=k>def</span> <span class=nf>bytestolist</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Convert a compressed line to an object.</span>
<span class=sd>    </span>
<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    x: bytes</span>
<span class=sd>        The compressed line.</span>
<span class=sd>    </span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    object</span>
<span class=sd>        The decompressed object.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>decompress</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>isbytes</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span></div>


<div class=viewcode-block id=listtostirng><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.listtostirng>[docs]</a><span class=k>def</span> <span class=nf>listtostirng</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>sep</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Convert a list to string, that is easier to store.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    l: list of strs or lists</span>
<span class=sd>        The list to convert, which can contain any number of dimensions.</span>
<span class=sd>    sep: list of strs</span>
<span class=sd>        The seperators for each dimension.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    str</span>
<span class=sd>        The converted string.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>l</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=p>(</span><span class=nb>list</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)):</span>
        <span class=k>return</span> <span class=n>sep</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>listtostirng</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>sep</span><span class=p>[</span><span class=mi>1</span><span class=p>:]),</span> <span class=n>l</span><span class=p>))</span>
    <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>l</span><span class=p>)</span></div>


<div class=viewcode-block id=multiopen><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.multiopen>[docs]</a><span class=k>def</span> <span class=nf>multiopen</span><span class=p>(</span><span class=n>pool</span><span class=p>,</span> <span class=n>func</span><span class=p>,</span> <span class=n>l</span><span class=p>,</span> <span class=n>semaphore</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>nlines</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>unordered</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>return_num</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>extra</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>interval</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>bar</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>desc</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=s2>&quot;it&quot;</span><span class=p>,</span> <span class=n>total</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Returns an interated object for process a file with multiple processors.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    pool: multiprocessing.Pool</span>
<span class=sd>        The pool for multiprocessing.</span>
<span class=sd>    func: function</span>
<span class=sd>        The function to process lines.</span>
<span class=sd>    l: File object</span>
<span class=sd>        The file object.</span>
<span class=sd>    semaphore: multiprocessing.Semaphore, optional, default: None</span>
<span class=sd>        The semaphore to acquire. If None (default), the object will be passed</span>
<span class=sd>        without control.</span>
<span class=sd>    nlines: int, optional, default: None</span>
<span class=sd>        The number of lines to pass to the function each time. If None (default),</span>
<span class=sd>        only one line will be passed to the function.</span>
<span class=sd>    unordered: bool, optional, default: True</span>
<span class=sd>        Whether the process can be unordered.</span>
<span class=sd>    return_num: bool, optional, default: False</span>
<span class=sd>        If True, adds a counter to an iterable.</span>
<span class=sd>    start: int, optional, default: 0</span>
<span class=sd>        The start number of the counter.</span>
<span class=sd>    extra: object, optional, default: None</span>
<span class=sd>        The extra object passed to the item.</span>
<span class=sd>    interval: obj, optional, default: None</span>
<span class=sd>        The interval of items that will be passed to the function. For example,</span>
<span class=sd>        if set to 10, a item will be passed once every 10 items and others will</span>
<span class=sd>        be dropped.</span>
<span class=sd>    bar: bool, optional, default: True</span>
<span class=sd>        If True, show a tqdm bar for the iteration.</span>
<span class=sd>    desc: str, optional, default: None</span>
<span class=sd>        The description of the iteration shown in the bar.</span>
<span class=sd>    unit: str, optional, default: it</span>
<span class=sd>        The unit of the iteration shown in the bar.</span>
<span class=sd>    total: int, optional, default: None</span>
<span class=sd>        The total number of the iteration shown in the bar.</span>
<span class=sd>    </span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    object</span>
<span class=sd>        An object that can be iterated.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>obj</span> <span class=o>=</span> <span class=n>l</span>
    <span class=k>if</span> <span class=n>nlines</span><span class=p>:</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=n>itertools</span><span class=o>.</span><span class=n>zip_longest</span><span class=p>(</span><span class=o>*</span><span class=p>[</span><span class=n>obj</span><span class=p>]</span> <span class=o>*</span> <span class=n>nlines</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>interval</span><span class=p>:</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=n>itertools</span><span class=o>.</span><span class=n>islice</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=n>interval</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>return_num</span><span class=p>:</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>start</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>semaphore</span><span class=p>:</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=n>produce</span><span class=p>(</span><span class=n>semaphore</span><span class=p>,</span> <span class=n>obj</span><span class=p>,</span> <span class=n>extra</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>unordered</span><span class=p>:</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=n>pool</span><span class=o>.</span><span class=n>imap_unordered</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>obj</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=n>pool</span><span class=o>.</span><span class=n>imap</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>obj</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>bar</span><span class=p>:</span>
        <span class=n>obj</span> <span class=o>=</span> <span class=n>tqdm</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=n>desc</span><span class=o>=</span><span class=n>desc</span><span class=p>,</span> <span class=n>unit</span><span class=o>=</span><span class=n>unit</span><span class=p>,</span> <span class=n>total</span><span class=o>=</span><span class=n>total</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>obj</span></div>


<div class=viewcode-block id=SCOUROPTIONS><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.SCOUROPTIONS>[docs]</a><span class=k>class</span> <span class=nc>SCOUROPTIONS</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;Scour (SVG optimization) options.&quot;&quot;&quot;</span>
    <span class=n>strip_xml_prolog</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>remove_titles</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>remove_descriptions</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>remove_metadata</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>remove_descriptive_elements</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>strip_comments</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>enable_viewboxing</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>strip_xml_space_attribute</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>strip_ids</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>shorten_ids</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>newlines</span> <span class=o>=</span> <span class=kc>False</span></div>


<div class=viewcode-block id=SharedRNGData><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.SharedRNGData>[docs]</a><span class=k>class</span> <span class=nc>SharedRNGData</span><span class=p>:</span>
    <span class=sd>&quot;&quot;&quot;Share ReacNetGenerator data with a submodule.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    rng: reacnetgenerator.ReacNetGenerator</span>
<span class=sd>        The centered ReacNetGenerator class.</span>
<span class=sd>    usedRNGKeys: list of strs</span>
<span class=sd>        Keys that needs to pass from ReacNetGenerator class to the submodule.</span>
<span class=sd>    returnedRNGKeys: list of strs</span>
<span class=sd>        Keys that needs to pass from the submodule to ReacNetGenerator class.</span>
<span class=sd>    extraNoneKeys: list of strs, optional, default: None</span>
<span class=sd>        Set keys to None, which will be used in the submodule.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rng</span><span class=p>,</span> <span class=n>usedRNGKeys</span><span class=p>,</span> <span class=n>returnedRNGKeys</span><span class=p>,</span> <span class=n>extraNoneKeys</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>rng</span> <span class=o>=</span> <span class=n>rng</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>returnedRNGKeys</span> <span class=o>=</span> <span class=n>returnedRNGKeys</span>
        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>usedRNGKeys</span><span class=p>:</span>
            <span class=nb>setattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>rng</span><span class=p>,</span> <span class=n>key</span><span class=p>))</span>
        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>returnedRNGKeys</span><span class=p>:</span>
            <span class=nb>setattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>extraNoneKeys</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>extraNoneKeys</span><span class=p>:</span>
                <span class=nb>setattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>

<div class=viewcode-block id=SharedRNGData.returnkeys><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.SharedRNGData.returnkeys>[docs]</a>    <span class=k>def</span> <span class=nf>returnkeys</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=sd>&quot;&quot;&quot;Return back keys to ReacNetGenerator class.&quot;&quot;&quot;</span>
        <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>returnedRNGKeys</span><span class=p>:</span>
            <span class=nb>setattr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>rng</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>))</span></div></div>


<div class=viewcode-block id=checksha256><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.checksha256>[docs]</a><span class=k>def</span> <span class=nf>checksha256</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>sha256_check</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Check sha256 of a file is correct.</span>
<span class=sd>    </span>
<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    filename: str</span>
<span class=sd>        The filename.</span>
<span class=sd>    sha256_check: str or list of strs</span>
<span class=sd>        The sha256 to be checked.</span>
<span class=sd>    </span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    bool</span>
<span class=sd>        Indicate whether sha256 is correct.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>filename</span><span class=p>):</span>
        <span class=k>return</span>
    <span class=n>h</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>()</span>
    <span class=n>b</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=mi>128</span><span class=o>*</span><span class=mi>1024</span><span class=p>)</span>
    <span class=n>mv</span> <span class=o>=</span> <span class=nb>memoryview</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>,</span> <span class=n>buffering</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>n</span> <span class=ow>in</span> <span class=nb>iter</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>f</span><span class=o>.</span><span class=n>readinto</span><span class=p>(</span><span class=n>mv</span><span class=p>),</span> <span class=mi>0</span><span class=p>):</span>
            <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>mv</span><span class=p>[:</span><span class=n>n</span><span class=p>])</span>
    <span class=n>sha256</span> <span class=o>=</span> <span class=n>h</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;SHA256 of </span><span class=si>{</span><span class=n>filename</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>sha256</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>sha256</span> <span class=ow>in</span> <span class=n>must_be_list</span><span class=p>(</span><span class=n>sha256_check</span><span class=p>):</span>
        <span class=k>return</span> <span class=kc>True</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&quot;SHA256 is not correct.&quot;</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
    <span class=k>return</span> <span class=kc>False</span></div>


<div class=viewcode-block id=download_file><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.download_file>[docs]</a><span class=k>async</span> <span class=k>def</span> <span class=nf>download_file</span><span class=p>(</span><span class=n>urls</span><span class=p>,</span> <span class=n>pathfilename</span><span class=p>,</span> <span class=n>sha256</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Download files from remote urls if not exists.</span>
<span class=sd>    </span>
<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    urls: str or list of strs</span>
<span class=sd>        The url(s) that is available to download.</span>
<span class=sd>    pathfilename: str</span>
<span class=sd>        The downloading path of the file.</span>
<span class=sd>    sha256: str</span>
<span class=sd>        Sha256 of the file. If not None and match the file, the download will be skiped.</span>
<span class=sd>    </span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    pathfilename: str</span>
<span class=sd>        The downloading path of the file.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>s</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
    <span class=n>s</span><span class=o>.</span><span class=n>mount</span><span class=p>(</span><span class=s1>&#39;http://&#39;</span><span class=p>,</span> <span class=n>HTTPAdapter</span><span class=p>(</span><span class=n>max_retries</span><span class=o>=</span><span class=mi>3</span><span class=p>))</span>
    <span class=n>s</span><span class=o>.</span><span class=n>mount</span><span class=p>(</span><span class=s1>&#39;https://&#39;</span><span class=p>,</span> <span class=n>HTTPAdapter</span><span class=p>(</span><span class=n>max_retries</span><span class=o>=</span><span class=mi>3</span><span class=p>))</span>
    <span class=c1># download if not exists</span>
    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>isfile</span><span class=p>(</span><span class=n>pathfilename</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>sha256</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>checksha256</span><span class=p>(</span><span class=n>pathfilename</span><span class=p>,</span> <span class=n>sha256</span><span class=p>)):</span>
        <span class=k>return</span> <span class=n>pathfilename</span>

    <span class=c1># from https://stackoverflow.com/questions/16694907</span>
    <span class=k>for</span> <span class=n>url</span> <span class=ow>in</span> <span class=n>must_be_list</span><span class=p>(</span><span class=n>urls</span><span class=p>):</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Try to download </span><span class=si>{</span><span class=n>pathfilename</span><span class=si>}</span><span class=s2> from </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
        <span class=k>with</span> <span class=n>s</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>stream</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=k>as</span> <span class=n>r</span><span class=p>,</span> <span class=nb>open</span><span class=p>(</span><span class=n>pathfilename</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=n>shutil</span><span class=o>.</span><span class=n>copyfileobj</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>raw</span><span class=p>,</span> <span class=n>f</span><span class=p>)</span>
                <span class=k>break</span>
            <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Request </span><span class=si>{</span><span class=n>pathfilename</span><span class=si>}</span><span class=s2> Error.&quot;</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=n>e</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Cannot download </span><span class=si>{</span><span class=n>pathfilename</span><span class=si>}</span><span class=s2>.&quot;</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>pathfilename</span></div>


<div class=viewcode-block id=gather_download_files><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.gather_download_files>[docs]</a><span class=k>async</span> <span class=k>def</span> <span class=nf>gather_download_files</span><span class=p>(</span><span class=n>urls</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;See download_multifiles function for details.&quot;&quot;&quot;</span>
    <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>gather</span><span class=p>(</span><span class=o>*</span><span class=p>[</span><span class=n>download_file</span><span class=p>(</span><span class=n>jdata</span><span class=p>[</span><span class=s2>&quot;url&quot;</span><span class=p>],</span> <span class=n>jdata</span><span class=p>[</span><span class=s2>&quot;fn&quot;</span><span class=p>],</span> <span class=n>jdata</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;sha256&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>))</span> <span class=k>for</span> <span class=n>jdata</span> <span class=ow>in</span> <span class=n>urls</span><span class=p>])</span></div>


<div class=viewcode-block id=download_multifiles><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.download_multifiles>[docs]</a><span class=k>def</span> <span class=nf>download_multifiles</span><span class=p>(</span><span class=n>urls</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Download multiple files from dicts.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    urls: list of dicts</span>
<span class=sd>        The information of download files. Each dict should contain the following key:</span>
<span class=sd>            - url: str or list of strs</span>
<span class=sd>                The url(s) that is available to download.</span>
<span class=sd>            - pathfilename: str</span>
<span class=sd>                The downloading path of the file.</span>
<span class=sd>            - sha256: str, optional, default: None</span>
<span class=sd>                Sha256 of the file. If not None and match the file, the download will be skiped.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>asyncio</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>gather_download_files</span><span class=p>(</span><span class=n>urls</span><span class=p>))</span></div>


<div class=viewcode-block id=run_mp><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.run_mp>[docs]</a><span class=k>def</span> <span class=nf>run_mp</span><span class=p>(</span><span class=n>nproc</span><span class=p>,</span> <span class=o>**</span><span class=n>arg</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Process a file with multiple processors.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    nproc: int</span>
<span class=sd>        The number of processors to be used.</span>
<span class=sd>    Other parameters can be found in the `multiopen` function.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>pool</span> <span class=o>=</span> <span class=n>Pool</span><span class=p>(</span><span class=n>nproc</span><span class=p>,</span> <span class=n>maxtasksperchild</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span>
    <span class=n>semaphore</span> <span class=o>=</span> <span class=n>Semaphore</span><span class=p>(</span><span class=n>nproc</span><span class=o>*</span><span class=mi>150</span><span class=p>)</span>
    <span class=k>try</span><span class=p>:</span>
        <span class=n>results</span> <span class=o>=</span> <span class=n>multiopen</span><span class=p>(</span><span class=n>pool</span><span class=o>=</span><span class=n>pool</span><span class=p>,</span> <span class=n>semaphore</span><span class=o>=</span><span class=n>semaphore</span><span class=p>,</span> <span class=o>**</span><span class=n>arg</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
            <span class=k>yield</span> <span class=n>item</span>
            <span class=n>semaphore</span><span class=o>.</span><span class=n>release</span><span class=p>()</span>
    <span class=k>except</span><span class=p>:</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>exception</span><span class=p>(</span><span class=s2>&quot;run_mp failed&quot;</span><span class=p>)</span>
        <span class=n>pool</span><span class=o>.</span><span class=n>terminate</span><span class=p>()</span>
        <span class=k>raise</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>pool</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
    <span class=k>finally</span><span class=p>:</span>
        <span class=n>pool</span><span class=o>.</span><span class=n>join</span><span class=p>()</span></div>


<div class=viewcode-block id=must_be_list><a class=viewcode-back href=../../api/reacnetgenerator.html#reacnetgenerator.utils.must_be_list>[docs]</a><span class=k>def</span> <span class=nf>must_be_list</span><span class=p>(</span><span class=n>obj</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Convert a object to a list if the object is not a list.</span>
<span class=sd>    </span>
<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    obj: Object</span>
<span class=sd>        The object to convert.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    obj: list</span>
<span class=sd>        If the input object is not a list, returns a list that only contains that</span>
<span class=sd>        object. Otherwise, returns that object.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
        <span class=k>return</span> <span class=n>obj</span>
    <span class=k>return</span> <span class=p>[</span><span class=n>obj</span><span class=p>]</span></div>
</pre></div> </div> </main> <footer class="footer-article noprint"> <!-- Previous / next buttons --> <div class=prev-next-area> </div> </footer> </div> </div> <div class="footer-content row"> <footer class="col footer"><p> By Jinzhe Zeng<br> &copy; Copyright 2019-2022, East China Normal University.<br> </p> </footer> </div> </div> </div> </div> <!-- Scripts loaded after <body> so the DOM is not blocked --> <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script> </body> </html>